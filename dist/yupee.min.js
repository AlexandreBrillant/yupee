const $$=($$=>{let debugMode=false;function trace(actionId,...params){if(debugMode){const paramstr=params.join(",");console.log(`** [${actionId}] ** ${paramstr}`)}}class Yupees{static#singleton=null;static#singletonController=true;static instance(){if(Yupees.#singleton==null){Yupees.#singletonController=false;Yupees.#singleton=new Yupees;Yupees.#singletonController=true}return Yupees.#singleton}constructor(){if(Yupees.#singletonController)throw new"Illegal usage for the Yupees, use Yupees.instance()"}#yupeesStack=[];#startLoading=false;#yupsModel={};#listeners={};#data={};yup(yupid){return this.#yupsModel[yupid]}listen(eventId,handler){if(typeof this.#listeners[eventId]=="undefined"){this.#listeners[eventId]=[]}this.#listeners[eventId].push({handler:handler});trace("listen",eventId,handler)}fire(eventId,...args){if(this.#listeners[eventId]){this.#listeners[eventId].forEach(obj=>{const handler=obj.handler;handler(...args)})}trace("fire",eventId,args)}data(key,...args){if(args.length==0){if(typeof this.#data[key]=="undefined"){return null}else return this.#data[key]}else{this.#data[key]=args[0]}trace("data",key,args)}loadComponent(location,params){this.#yupeesStack.push({location:location,params:params});if(!this.#startLoading){this.#startLoading=true;this.loadNextComponent()}}#currentParams=null;#currentYupId=null;#yupid(location){const pathSep=location.lastIndexOf("/");if(pathSep>-1)return location.substring(pathSep+1);return location}loadNextComponent(){const component=this.#yupeesStack.shift();if(typeof component!="undefined"){let{location:location,params:params}=component;this.#currentYupId=this.#yupid(location);if(!location.includes("."))location+=".js";const scriptNode=document.createElement("script");scriptNode.addEventListener("load",()=>{Yupees.#singleton.loadNextComponent()});scriptNode.src=location;this.#currentParams=params;document.head.appendChild(scriptNode)}}start(){const currentComponent=new Yup(this.#currentYupId,this.#currentParams);this.#yupsModel[this.#currentYupId]=currentComponent;trace("start",this.#currentYupId);return currentComponent}}class Yup{#view;#eventStack;#actionStack;#params;#yupid;#model=[];constructor(yupid,params){this.#yupid=yupid;if(params instanceof Node){this.#view=params}else this.#params=params;this.#eventStack=[];this.#actionStack=[];if(!this.#view)this.#view=document.body}#children={};addChild(childName,selector){const node=this.#view.querySelector(selector);if(node==null){log("Unknown child ["+selector+"]")}else{this.#children[childName]=new Yup(childName,node);return this.#children[childName]}}child(childName){return this.#children[childName]}log(message){console.log(`Yup[${this.#yupid}] => (${message})`)}#binder(func){const that=this;return function(...args){args.push(that);func.apply(that,args)}}pushData(data,repaintMode){this.#model.push(data);if(typeof repaintMode=="undefined")repaintMode=true;if(repaintMode){this.paint()}}produce(name,value){Yupees.instance().fire("data:"+name,value)}consume(name,handler){Yupees.instance().listen("data:"+name,handler)}#itemRenderer=null;renderer(itemRenderer){this.#itemRenderer=itemRenderer}param(paramkey,defaultValue){if(this.#params&&this.#params[paramkey])return this.#params[paramkey];return defaultValue}paint(html){this.#actionStack.forEach(action=>{action()});this.#actionStack.splice(0,this.#actionStack.length);this.clean();if(typeof html=="undefined"){if(this.#itemRenderer!=null){this.#model.forEach(item=>this.#itemRenderer(this.#view,item))}else{this.#view.innerHTML=`Default renderer for YUP {${this.#yupid}} with this model [${this.#model}]`}}else{if(html instanceof Node){this.#view.appendChild(html)}else this.#view.innerHTML=html}return this}style(values){for(let property in values){this.#view.style[property]=values[property]}return this}event(evt,handler){this.#view.addEventListener(evt,this.#binder(handler));return this}action(handler){this.#actionStack.push(this.#binder(handler));return this}into(cssselector){try{const node=document.querySelector(cssselector);if(node!=null){this.#view=node}}catch(error){console.log(`Invalid selector [${cssselector} / ${error.message}] ? using document.body`);this.#view=document.body}return this}intoid(id){return this.into("@"+id)}getView(){return this.#view}clean(){const parentNode=this.#view;while(parentNode.firstChild)parentNode.removeChild(parentNode.firstChild);return this}selectAll(cssSelector){return this.getView().querySelectorAll(cssSelector)}select(cssSelector){return this.getView().querySelector(cssSelector)}}function _startingAll(){if(starting){starting.forEach(starting=>starting())}starting=null}let starting=[];let ready=false;const rooter=(...args)=>{ready=document.body?true:false;init=()=>{let usage=null;if(args.length)usage=args[0];const yupees=Yupees.instance();if(typeof usage=="object"){const{load:load,params:params}=usage;yupees.loadComponent(load,params)}};if(ready)init();else{starting.push(init);document.addEventListener("DOMContentLoaded",()=>{ready=true;_startingAll()})}};function init_data_yup(){const nodes=document.querySelectorAll("*");for(node of nodes){if(node.hasAttribute("data-yup")&&node.id){$$.load("yups/"+node.id,node)}}}(()=>{document.addEventListener("DOMContentLoaded",()=>{init_data_yup()})})();$$.rooter=rooter;$$.start=()=>Yupees.instance().start();$$.load=(yupcomponent,params)=>{rooter({load:yupcomponent,params:params});trace("load",yupcomponent,params);return $$};$$.listen=(actionId,...actions)=>{actions.forEach(action=>Yupees.instance().listen(actionId,action));trace(actionId,actions);return $$};$$.fire=(actionId,...params)=>{Yupees.instance().fire(actionId,params);trace("fire",actionId,params);return $$};$$.data=(key,...params)=>{if(params.length==0)return Yupees.instance().data(key,...params);Yupees.instance().data(key,...params);trace("data",key,params);return $$};$$.debugMode=()=>{debugMode=!debugMode};return $$})({}||$$);