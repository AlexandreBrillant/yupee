const $$=($$=>{let debugMode=false;let deepTrace=false;let traceMode=0;function _trace(actionId,...params){if(debugMode){const paramstr=params.join(",");const log=`** [${actionId}] ** ${paramstr}`;if(traceMode==0)console.log(log);else{document.body.insertAdjacentHTML("beforeend",`<div class='yuptrace'>${log}</div>`)}if(deepTrace){params.forEach(element=>{if(typeof element=="object"){if(traceMode==0)console.log(element);else{document.body.insertAdjacentHTML("beforeend",`<div class='yuptrace'>${log}</div>`)}}})}}}class Yupees{static#singleton=null;static#singletonController=true;static instance(){if(Yupees.#singleton==null){Yupees.#singletonController=false;Yupees.#singleton=new Yupees;Yupees.#singletonController=true}return Yupees.#singleton}constructor(){if(Yupees.#singletonController)throw new"Illegal usage for the Yupees, use Yupees.instance()"}#yupeesStack=[];#startLoading=false;#yupRoot=null;#listeners={};#data={};yup(yupid){_trace("yup",yupid,this.root());return this.root().child(yupid)}root(){return this.#yupRoot}listen(eventId,handler){if(typeof this.#listeners[eventId]=="undefined"){this.#listeners[eventId]=[]}this.#listeners[eventId].push({handler:handler});_trace("listen",eventId,handler)}fire(eventId,...args){if(this.#listeners[eventId]){this.#listeners[eventId].forEach(obj=>{const handler=obj.handler;handler(...args)})}_trace("fire",eventId,args)}data(key,...args){if(args.length==0){if(typeof this.#data[key]=="undefined"){return null}else return this.#data[key]}else{this.#data[key]=args[0]}_trace("data",key,args)}loadComponent(location,params){this.#yupeesStack.push({location:location,params:params});if(!this.#startLoading){this.#startLoading=true;this.loadNextComponent()}}#currentParams=null;#currentYupId=null;#yupid(location){const pathSep=location.lastIndexOf("/");if(pathSep>-1)return location.substring(pathSep+1);return location}loadNextComponent(){const component=this.#yupeesStack.shift();if(typeof component!="undefined"){let{location:location,params:params}=component;this.#currentYupId=this.#yupid(location);if(!location.includes("."))location+=".js";const scriptNode=document.createElement("script");scriptNode.addEventListener("load",()=>{Yupees.#singleton.loadNextComponent()});scriptNode.addEventListener("error",()=>{_trace("load","Can't load "+location+" ?")});scriptNode.src=location;this.#currentParams=params;document.head.appendChild(scriptNode)}}start(){const currentComponent=new Yup(this.#currentYupId,this.#currentParams);if(this.#yupRoot==null){this.#yupRoot=new Yup("root",document.body)}this.#yupRoot.addChild(currentComponent);_trace("start",this.#currentYupId);return currentComponent}}class Yup{#container;#actionStack;#params;#yupid;#model=[];#childid=1;#parent=null;constructor(yupid,params){this.#yupid=yupid;if(params){if(params instanceof Node){this.#container=params}else{if(params._into){this.#container=params._into;delete params._into}this.#params=params}}if(this.#container){if(this.#container.attributes){this.#params=this.#params||{};for(let attribute of this.#container.attributes){params[attribute.name]=attribute.value}}}this.#actionStack=[];if(!this.#container)this.#container=document.body}#children={};addChildBySelector(childName,selector){const node=this.container().querySelector(selector);if(node==null){this.trace("Unknown child ["+selector+"]")}else{this.#setchild(childName,new Yup(childName,node));return this.#children[childName]}}#setchild(name,yup){yup.#parent=this;this.#children[name]=yup;return yup}addChild(content){let yupid;let yup;if(content instanceof Yup){yupid=content.yupid;yup=content}else{if(typeof content=="string"){this.container().insertAdjacentHTML("beforeend",content);content=this.container().lastChild}if(content instanceof Node){yupid="yup"+this.#childid++;yup=new Yup(yupid,content);this.container().appendChild(yup.container())}else{this.trace("Invalid addChild parameter ?");this.trace(content);return null}}return this.#setchild(yupid,yup)}child(childName){return this.#children[childName]}parent(){return this.#parent}trace(message){_trace(`Yup[${this.#yupid}] => (${message})`)}#binder(func){const that=this;return function(...args){args.push(that);func.apply(that,args)}}pushData(data,repaintMode){this.#model.push(data);if(typeof repaintMode=="undefined")repaintMode=true;if(repaintMode){this.paint()}}produce(name,value){Yupees.instance().fire("data:"+name,value)}consume(name,handler){Yupees.instance().listen("data:"+name,handler)}#itemRenderer=null;renderer(itemRenderer){this.#itemRenderer=itemRenderer}param(paramkey,defaultValue){if(this.#params&&this.#params[paramkey])return this.#params[paramkey];return defaultValue}paint(html){this.#actionStack.forEach(action=>{action()});this.#actionStack.splice(0,this.#actionStack.length);this.clean();if(typeof html=="undefined"){if(this.#itemRenderer!=null){this.#model.forEach(item=>this.#itemRenderer(this.#container,item))}else{this.#container.innerHTML=`Default renderer for YUP {${this.#yupid}} with this model [${this.#model}]`}}else{if(html instanceof Node){this.#container.appendChild(html)}else this.#container.innerHTML=html}return this}style(values){for(let property in values){this.#container.style[property]=values[property]}return this}event(evt,handler){this.#container.addEventListener(evt,this.#binder(handler));return this}action(handler){this.#actionStack.push(this.#binder(handler));return this}into(cssselector){try{const node=document.querySelector(cssselector);if(node!=null){this.#container=node}}catch(error){console.log(`Invalid selector [${cssselector} / ${error.message}] ? using document.body`);this.#container=document.body}return this}intoid(id){return this.into("@"+id)}container(){return this.#container}clean(){const parentNode=this.#container;while(parentNode.firstChild)parentNode.removeChild(parentNode.firstChild);return this}selectAll(cssSelector){return this.container().querySelectorAll(cssSelector)}select(cssSelector){return this.container().querySelector(cssSelector)}yupid(){return this.#yupid}show(displayMode){this.style({display:displayMode??"block"})}hide(){this.style({display:"none"})}value(content){if(typeof content=="undefined")return this.container().value;else this.container().value=content}}function _startingAll(){if(starting){starting.forEach(starting=>starting())}starting=null}let starting=[];let ready=false;const rooter=(...args)=>{ready=document.body?true:false;init=()=>{let usage=null;if(args.length)usage=args[0];const yupees=Yupees.instance();if(typeof usage=="object"){const{load:load,params:params}=usage;yupees.loadComponent(load,params)}};if(ready)init();else{starting.push(init);document.addEventListener("DOMContentLoaded",()=>{ready=true;_startingAll()})}};(()=>{function resolve_yup_path(node){const t=[];while(node){if(node.nodeType==Node.ELEMENT_NODE&&node.hasAttribute("data-yup")){if(node.id){t.unshift(node.id)}}node=node.parentNode}return t.join("/")}function process_data_yup(){const nodes=document.querySelectorAll("*");for(node of nodes){if(node.hasAttribute("data-yup")&&node.id){$$.load("yups/"+resolve_yup_path(node),{_into:node})}}}document.addEventListener("DOMContentLoaded",()=>{process_data_yup()})})();$$.rooter=rooter;$$.start=()=>Yupees.instance().start();$$.load=(yupcomponent,params)=>{rooter({load:yupcomponent,params:params});_trace("load",yupcomponent,params);return $$};$$.listen=(actionId,...actions)=>{actions.forEach(action=>Yupees.instance().listen(actionId,action));_trace(actionId,actions);return $$};$$.fire=(actionId,...params)=>{Yupees.instance().fire(actionId,params);_trace("fire",actionId,params);return $$};$$.data=(key,...params)=>{if(params.length==0)return Yupees.instance().data(key,...params);Yupees.instance().data(key,...params);_trace("data",key,params);return $$};$$.yup=name=>Yupees.instance().yup(name);$$.DEBUG_CONSOLE=0;$$.DEBUG_BODY=1;$$.debugMode=mode=>{traceMode=mode??$$.DEBUG_CONSOLE;debugMode=!debugMode};return $$})({}||$$);